# The Supermarket Fish Problem

This is part of the [Performance study](https://github.com/converged-computing/performance-study) and the single-node-benchmark analysis. The analyses afforded generation of a lot of intermediate data and a web interface, and were moved here for better organization.

[![DOI](https://zenodo.org/badge/837429553.svg)](https://zenodo.org/doi/10.5281/zenodo.13738495)

Have you ever been to the supermarket and ordered white fish? You may be getting tilapia, flounder, branzino, catfish, cod, haddock, hake, halibut, pollock, sea bass, sole, or whiting. The same is true for cloud CPU architectures. You may know that you are getting some flavor of Intel, but it's unclear if it's Skylake, Icelake, Sandy Bridge, or some other flavor. We did a large [performance study](https://github.com/converged-computing/performance-study) in August 2024 that looked across many different environments, clouds, and instance types, and can now reflect on what we found. In the case of finding a potpourri of architectures, we call this the supermarket fish problem.

 - 🐠🐟 [View the Fish!](https://converged-computing.org/supermarket-fish-problem/web/machines/)

**Under development** data processing is underway - a table will be added to each view!

## TODO:

- summary data file for each output file
- table that summarizes each environment (with counts)
- flags and bugs should have some kind of venn diagram that crosses spaces
- sysbench metrics should be plots (not tables)
- cpuinfo -> cpu MHz and bogomips also needs plots (values are all over the place)
- Not sure if this is interesting, but [data/azure/cyclecloud/cpu/256/node-0/raw/dmidecode](data/azure/cyclecloud/cpu/256/node-0/raw/dmidecode) has Core Enabled for each of 32 and 64.

## Generate

Make some pngs (they render better in react):

```bash
for filename in $(find . -name machine.svg)
  do
    echo $filename
    directory=$(dirname $filename)
    outpng="$directory/machine.png"
    echo inkscape $filename -o $outpng
    inkscape $filename -o $outpng
done
```

To generate data for the gallery:

```bash
python 1-generate-gallery.py
```

Note that I did manually add the index.html/script.js to each directory, and tweaked them (titles, dimensions) for each.
This generates the table (requires `pip install pandas`):

```bash
python 2-generate-table.py
```

Again, I copy pasted the same table snippet into the UI that would read the data generated by the script.

## Results

Here are some one off result images:

### CPU Clock Speed

We can see that there is a hidden supermarket problem for AWS and clock speed. When a group doesn't show up (e.g., Google and Azure for many) it's because the values are all the same. I think these are the lines we see in the graph without color - they are histograms for one value.

#### Clock Speed CPU Size 32

![web/img/clock-speeds-cpu-size-32.png](web/img/clock-speeds-cpu-size-32.png)

#### Clock Speed CPU Size 64

![web/img/clock-speeds-cpu-size-64.png](web/img/clock-speeds-cpu-size-64.png)

#### Clock Speed CPU Size 128

![web/img/clock-speeds-cpu-size-128.png](web/img/clock-speeds-cpu-size-128.png)

#### Clock Speed CPU Size 256

![web/img/clock-speeds-cpu-size-256.png](web/img/clock-speeds-cpu-size-256.png)

#### Clock Speed GPU

![web/img/clock-speeds-gpu.png](web/img/clock-speeds-gpu.png)

### Sysbench Plots

![web/img/sysbench-cpu-run-cpu_speed_events_per_second-cpu.png](web/img/sysbench-cpu-run-cpu_speed_events_per_second-cpu.png)
![web/img/sysbench-cpu-run-cpu_speed_events_per_second-gpu.png](web/img/sysbench-cpu-run-cpu_speed_events_per_second-gpu.png)
![web/img/sysbench-cpu-run-latency_ms_95th_percentile-cpu.png](web/img/sysbench-cpu-run-latency_ms_95th_percentile-cpu.png)
![web/img/sysbench-cpu-run-latency_ms_95th_percentile-gpu.png](web/img/sysbench-cpu-run-latency_ms_95th_percentile-gpu.png)
![web/img/sysbench-cpu-run-latency_ms_avg-cpu.png](web/img/sysbench-cpu-run-latency_ms_avg-cpu.png)
![web/img/sysbench-cpu-run-latency_ms_avg-gpu.png](web/img/sysbench-cpu-run-latency_ms_avg-gpu.png)
![web/img/sysbench-cpu-run-latency_ms_max-cpu.png](web/img/sysbench-cpu-run-latency_ms_max-cpu.png)
![web/img/sysbench-cpu-run-latency_ms_max-gpu.png](web/img/sysbench-cpu-run-latency_ms_max-gpu.png)
![web/img/sysbench-cpu-run-latency_ms_min-cpu.png](web/img/sysbench-cpu-run-latency_ms_min-cpu.png)
![web/img/sysbench-cpu-run-latency_ms_min-gpu.png](web/img/sysbench-cpu-run-latency_ms_min-gpu.png)
![web/img/sysbench-cpu-run-latency_ms_sum-cpu.png](web/img/sysbench-cpu-run-latency_ms_sum-cpu.png)
![web/img/sysbench-cpu-run-latency_ms_sum-gpu.png](web/img/sysbench-cpu-run-latency_ms_sum-gpu.png)
![web/img/sysbench-cpu-run-total_number_events-cpu.png](web/img/sysbench-cpu-run-total_number_events-cpu.png)
![web/img/sysbench-cpu-run-total_number_events-gpu.png](web/img/sysbench-cpu-run-total_number_events-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-fsyncs_per_second-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-fsyncs_per_second-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-fsyncs_per_second-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-fsyncs_per_second-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_95th_percentile-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_95th_percentile-!cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_95th_percentile-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_95th_percentile-!gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_avg-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_avg-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_avg-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_avg-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_max-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_max-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_max-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_max-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_min-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_min-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_min-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_min-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_sum-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_sum-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_sum-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-latency_ms_sum-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-total_number_events-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-total_number_events-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-total_number_events-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-total_number_events-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-writes_per_second-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-writes_per_second-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-writes_per_second-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-writes_per_second-gpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-written_mib_per_second-cpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-written_mib_per_second-cpu.png)
![web/img/sysbench-fileio-run-file-test-modeseqwr-written_mib_per_second-gpu.png](web/img/sysbench-fileio-run-file-test-modeseqwr-written_mib_per_second-gpu.png)
![web/img/sysbench-mutex-run-latency_ms_95th_percentile-cpu.png](web/img/sysbench-mutex-run-latency_ms_95th_percentile-cpu.png)
![web/img/sysbench-mutex-run-latency_ms_95th_percentile-gpu.png](web/img/sysbench-mutex-run-latency_ms_95th_percentile-gpu.png)
![web/img/sysbench-mutex-run-latency_ms_avg-cpu.png](web/img/sysbench-mutex-run-latency_ms_avg-cpu.png)
![web/img/sysbench-mutex-run-latency_ms_avg-gpu.png](web/img/sysbench-mutex-run-latency_ms_avg-gpu.png)
![web/img/sysbench-mutex-run-latency_ms_max-cpu.png](web/img/sysbench-mutex-run-latency_ms_max-cpu.png)
![web/img/sysbench-mutex-run-latency_ms_max-gpu.png](web/img/sysbench-mutex-run-latency_ms_max-gpu.png)
![web/img/sysbench-mutex-run-latency_ms_min-cpu.png](web/img/sysbench-mutex-run-latency_ms_min-cpu.png)
![web/img/sysbench-mutex-run-latency_ms_min-gpu.png](web/img/sysbench-mutex-run-latency_ms_min-gpu.png)
![web/img/sysbench-mutex-run-latency_ms_sum-cpu.png](web/img/sysbench-mutex-run-latency_ms_sum-cpu.png)
![web/img/sysbench-mutex-run-latency_ms_sum-gpu.png](web/img/sysbench-mutex-run-latency_ms_sum-gpu.png)
![web/img/sysbench-threads-run-latency_ms_95th_percentile-cpu.png](web/img/sysbench-threads-run-latency_ms_95th_percentile-cpu.png)
![web/img/sysbench-threads-run-latency_ms_95th_percentile-gpu.png](web/img/sysbench-threads-run-latency_ms_95th_percentile-gpu.png)
![web/img/sysbench-threads-run-latency_ms_avg-cpu.png](web/img/sysbench-threads-run-latency_ms_avg-cpu.png)
![web/img/sysbench-threads-run-latency_ms_avg-gpu.png](web/img/sysbench-threads-run-latency_ms_avg-gpu.png)
![web/img/sysbench-threads-run-latency_ms_max-cpu.png](web/img/sysbench-threads-run-latency_ms_max-cpu.png)
![web/img/sysbench-threads-run-latency_ms_max-gpu.png](web/img/sysbench-threads-run-latency_ms_max-gpu.png)
![web/img/sysbench-threads-run-latency_ms_min-cpu.png](web/img/sysbench-threads-run-latency_ms_min-cpu.png)
![web/img/sysbench-threads-run-latency_ms_min-gpu.png](web/img/sysbench-threads-run-latency_ms_min-gpu.png)
![web/img/sysbench-threads-run-latency_ms_sum-cpu.png](web/img/sysbench-threads-run-latency_ms_sum-cpu.png)
![web/img/sysbench-threads-run-latency_ms_sum-gpu.png](web/img/sysbench-threads-run-latency_ms_sum-gpu.png)
![web/img/sysbench-threads-run-total_number_events-cpu.png](web/img/sysbench-threads-run-total_number_events-cpu.png)
![web/img/sysbench-threads-run-total_number_events-gpu.png](web/img/sysbench-threads-run-total_number_events-gpu.png)

## License

HPCIC DevTools is distributed under the terms of the MIT license.
All new contributions must be made under this license.

See [LICENSE](https://github.com/converged-computing/cloud-select/blob/main/LICENSE),
[COPYRIGHT](https://github.com/converged-computing/cloud-select/blob/main/COPYRIGHT), and
[NOTICE](https://github.com/converged-computing/cloud-select/blob/main/NOTICE) for details.

SPDX-License-Identifier: (MIT)

LLNL-CODE- 842614
